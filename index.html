<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BASEMEME.win - Meme Generator</title>
    <meta name="description" content="Create high-IQ memes for the BASE ecosystem and earn $BASEMEME tokens">
    
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://basememe.com/">
    <meta property="og:title" content="BASEMEME.win - Meme Generator">
    <meta property="og:description" content="Create high-IQ memes for the BASE ecosystem and earn $BASEMEME tokens">
    <meta property="og:image" content="logo.png">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://basememe.com/">
    <meta name="twitter:title" content="BASEMEME.win - Meme Generator">
    <meta name="twitter:description" content="Create high-IQ memes for the BASE ecosystem and earn $BASEMEME tokens">
    <meta name="twitter:image" content="logo.png">
    
    <meta name="theme-color" content="#00a8ff">
    
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            position: relative;
            background: #000;
        }

        /* Matrix-style background effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(0deg, 
                rgba(0, 72, 255, 0.03) 25%, 
                rgba(0, 0, 0, 0.2) 50%,
                rgba(0, 17, 54, 0.2) 75%);
            animation: scan 5s linear infinite;
            pointer-events: none;
            z-index: -1;
        }

        /* Hexagonal grid background */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 50% 50%, rgba(0, 89, 255, 0.1) 2px, transparent 4px) 0 0 / 50px 50px,
                linear-gradient(0deg, transparent 24%, rgba(0, 89, 255, 0.05) 25%, rgba(0, 89, 255, 0.05) 26%, transparent 27%, transparent 74%, rgba(0, 89, 255, 0.05) 75%, rgba(0, 89, 255, 0.05) 76%, transparent 77%, transparent) 0 0 / 50px 50px;
            opacity: 0.3;
            z-index: -2;
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes scan {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        .main-header {
            text-align: center;
            color: #00a8ff;
            margin-bottom: 40px;
            position: relative;
            padding: 20px;
            border: 1px solid rgba(0, 149, 255, 0.2);
            background: rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 20px rgba(0, 89, 255, 0.2);
        }

        .main-header h1 {
            font-size: 5em;
            margin: 0;
            font-family: 'Share Tech Mono', 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 10px;
            animation: glitch 5s infinite;
            margin-bottom: 20px;
        }

        .main-header p {
            font-family: 'Share Tech Mono', 'Courier New', monospace;
            font-size: 1.1em;
            max-width: 800px;
            margin: 20px auto;
            line-height: 1.6;
            color: #00a8ff;
            text-shadow: 0 0 5px #00a8ff;
        }

        .header-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .header-links a {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00a8ff;
            color: #00a8ff;
            padding: 8px 16px;
            text-decoration: none;
            font-family: 'Share Tech Mono', monospace;
            font-size: 14px;
            text-align: center;
            transition: all 0.3s;
        }

        .header-links a:hover {
            background: rgba(0, 168, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 168, 255, 0.3);
        }

        @keyframes glitch {
            0% { 
                text-shadow: 3px 0 #ff0000, -3px 0 #00a8ff;
                transform: translate(2px, 2px);
            }
            1% { 
                text-shadow: -3px 0 #ff0000, 3px 0 #00a8ff;
                transform: translate(-2px, -2px);
            }
            2%, 8% { 
                text-shadow: 2px 0 #ff0000, -2px 0 #00a8ff;
                transform: translate(0, 0);
            }
            9% {
                text-shadow: -2px 0 #ff0000, 2px 0 #00a8ff;
                transform: translate(2px, -2px);
            }
            10% { 
                text-shadow: none;
                transform: translate(0, 0);
            }
            100% { 
                text-shadow: none;
                transform: translate(0, 0);
            }
        }

        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        .computer-screen {
            width: 100%;
            max-width: 800px;
            min-width: 0;
            background: #000;
            border: 1px solid rgba(0, 149, 255, 0.2);
            overflow: hidden;
        }

        .title-bar {
            background-color: #000080;
            color: white;
            padding: 8px 12px;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toolbar {
            background-color: #c0c0c0;
            border-bottom: 1px solid #808080;
            padding: 4px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .tool-section {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 2px 4px;
            border-bottom: 1px solid #808080;
        }

        .tool-section:last-child {
            border-bottom: none;
        }

        .tool-section-label {
            font-size: 12px;
            font-weight: bold;
            color: #000;
            min-width: 40px;
        }

        .color-picker, .color-swatch {
            width: 30px;
            height: 30px;
            border: 1px solid #999;
            cursor: pointer;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .slider-label {
            font-size: 12px;
            color: #333;
            white-space: nowrap;
        }

        .slider {
            width: 80px;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            padding-bottom: 100%;
            height: 0;
            overflow: hidden;
            background: #333333;
            border: 1px solid #000;
        }

        #memeImage, #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .meme-text {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-family: Impact, sans-serif;
            text-align: center;
            width: 90%;
            text-shadow: 
                2px 2px 0 #000,
                -2px -2px 0 #000,
                2px -2px 0 #000,
                -2px 2px 0 #000;
            text-transform: uppercase;
            pointer-events: none;
            user-select: none;
            white-space: pre-wrap;
            word-break: break-word;
            padding: 0 10px;
        }

        #topText {
            top: 20px;
            max-height: 40%;
            overflow: hidden;
        }

        #bottomText {
            bottom: 20px;
            max-height: 40%;
            overflow: hidden;
        }

        #fileInput {
            display: none;
        }

        .text-input {
            height: auto;
            min-height: 22px;
            font-size: 11px;
            padding: 2px 4px;
            border: 1px solid #808080;
            width: 120px;
            resize: vertical;
            font-family: Arial, sans-serif;
        }

        .font-select, .color-select {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        button.tool {
            padding: 4px 8px;
            background: #c0c0c0;
            border: 1px solid #808080;
            border-radius: 0;
            min-width: 60px;
            height: 24px;
            font-size: 12px;
        }

        button.tool:hover {
            background: #d0d0d0;
        }

        select {
            height: 24px;
            font-size: 12px;
            padding: 2px 4px;
            background: #c0c0c0;
            border: 1px solid #808080;
        }

        select:hover {
            background: #d0d0d0;
        }

        .tool {
            min-width: 60px;
        }

        .tool:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .color-picker {
            width: 24px;
            height: 24px;
            padding: 0;
            border: 1px solid #808080;
        }

        /* Add mouse trail effect */
        .cursor-trail {
            position: fixed;
            width: 4px;
            height: 4px;
            background: rgba(0, 149, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            z-index: 10000;
            transition: 0.1s;
            animation: trailFade 1s linear forwards;
        }

        @keyframes trailFade {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }

        /* Update container layout */
        .page-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            background: #000;
        }

        .app-container {
            width: 1200px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(0, 149, 255, 0.2);
            box-shadow: 0 0 30px rgba(0, 89, 255, 0.2);
        }

        .app-content {
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .left-panel {
            flex: 0 0 400px;
            padding: 30px;
            border-right: 1px solid rgba(0, 149, 255, 0.2);
        }

        .right-panel {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            min-width: 0;
        }

        .left-panel h1 {
            font-size: 4em;
            color: #00a8ff;
            font-family: 'Share Tech Mono', monospace;
            margin: 0 0 20px 0;
            letter-spacing: 6px;
        }

        .left-panel p {
            color: #00a8ff;
            font-family: 'Share Tech Mono', monospace;
            font-size: 1em;
            line-height: 1.6;
            margin-bottom: 30px;
        }



        .header-links a {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00a8ff;
            color: #00a8ff;
            padding: 8px 16px;
            text-decoration: none;
            font-family: 'Share Tech Mono', monospace;
            font-size: 14px;
            text-align: center;
            transition: all 0.3s;
        }

        .header-links a:hover {
            background: rgba(0, 168, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 168, 255, 0.3);
        }

        /* Mobile responsiveness */
        @media (max-width: 1023px) {
            .app-container {
                width: 100%;
                margin: 10px;
            }
            
            .app-content {
                flex-direction: column;
            }
            
            .left-panel {
                border-right: none;
                border-bottom: 1px solid rgba(0, 149, 255, 0.2);
            }
        }

        /* Instructions styling */
        .instructions {
            margin-top: 40px;
            color: #fff;
            font-family: 'Share Tech Mono', monospace;
            font-size: 16px;
            line-height: 2.5;
            letter-spacing: 1px;
        }

        .instruction-step {
            position: relative;
            padding-left: 20px;
            transition: all 0.3s ease;
            animation: instructionGlitch 8s infinite;
        }

        .instruction-step::before {
            content: '>';
            position: absolute;
            left: 0;
            color: #00a8ff;
        }

        .instruction-step:nth-child(odd) {
            animation-delay: 0.5s;
        }

        @keyframes instructionGlitch {
            0%, 100% { transform: translateX(0); }
            88% { transform: translateX(0); }
            90% { transform: translateX(-2px) skewX(20deg); }
            92% { transform: translateX(2px) skewX(-20deg); }
            94% { transform: translateX(-2px); }
            96% { transform: translateX(2px); }
        }

        .instructions a {
            color: #fffc00;
            text-decoration: none;
            border-bottom: 1px solid #fffc00;
            transition: all 0.3s ease;
        }

        .instructions a:hover {
            color: #fff;
            border-color: #fff;
            text-shadow: 0 0 8px rgba(255,255,255,0.8);
        }

        /* Smoother title glitch effect */
        .mega-glitch {
            font-size: 5em;
            color: #fff;
            position: relative;
            text-shadow: 
                0 0 10px rgba(0, 168, 255, 0.8),
                0 0 20px rgba(0, 168, 255, 0.5);
            animation: titleGlitch 4s infinite;
        }

        @keyframes titleGlitch {
            0%, 100% { 
                text-shadow: 
                    0.05em 0 0 #00fffc,
                    -0.03em -0.04em 0 #00a8ff,
                    0.025em 0.04em 0 #0051ff;
            }
            15% { 
                text-shadow: 
                    0.05em 0 0 #00fffc,
                    -0.03em -0.04em 0 #00a8ff,
                    0.025em 0.04em 0 #0051ff;
            }
            16% { 
                text-shadow: 
                    -0.05em -0.025em 0 #00fffc,
                    0.025em 0.035em 0 #00a8ff,
                    -0.05em -0.05em 0 #0051ff;
            }
            49% { 
                text-shadow: 
                    -0.05em -0.025em 0 #00fffc,
                    0.025em 0.035em 0 #00a8ff,
                    -0.05em -0.05em 0 #0051ff;
            }
            50% { 
                text-shadow: 
                    0.05em 0.035em 0 #00fffc,
                    0.03em 0 0 #00a8ff,
                    0 -0.04em 0 #0051ff;
            }
            99% { 
                text-shadow: 
                    0.05em 0.035em 0 #00fffc,
                    0.03em 0 0 #00a8ff,
                    0 -0.04em 0 #0051ff;
            }
            100% { 
                text-shadow: 
                    -0.05em 0 0 #00fffc,
                    -0.025em -0.04em 0 #00a8ff,
                    -0.04em -0.025em 0 #0051ff;
            }
        }

        .mega-glitch::before,
        .mega-glitch::after {
            content: 'BASEMEME';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.8;
        }

        .mega-glitch::before {
            animation: glitchOffset 4s infinite;
            text-shadow: 2px 0 #00a8ff;
            clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
        }

        .mega-glitch::after {
            animation: glitchOffset 4s infinite reverse;
            text-shadow: -2px 0 #0051ff;
            clip-path: polygon(0 55%, 100% 55%, 100% 100%, 0 100%);
        }

        /* Animated cyber lines (replace the blue curves) */
        .cyber-line {
            position: fixed;
            width: 3px;
            height: 100vh;
            background: linear-gradient(
                to bottom,
                transparent,
                #00a8ff,
                #0051ff,
                transparent
            );
            filter: blur(1px);
            opacity: 0.7;
            z-index: -1;
        }

        .cyber-line-left {
            left: 5%;
            animation: cyberWave 8s ease-in-out infinite;
        }

        .cyber-line-right {
            right: 5%;
            animation: cyberWave 8s ease-in-out infinite reverse;
        }

        @keyframes smoothGlitch {
            0%, 100% { transform: none; }
            20% { transform: skewX(-0.5deg); }
            40% { transform: skewX(0.5deg); }
            60% { transform: skewX(-0.2deg); }
            80% { transform: skewX(0.2deg); }
        }

        @keyframes glitchOffset {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(2px, -2px); }
            60% { transform: translate(-1px, 1px); }
            80% { transform: translate(1px, -1px); }
        }

        @keyframes cyberWave {
            0%, 100% { 
                transform: scaleY(0.8) translateX(0) skewX(0);
                filter: brightness(1);
            }
            25% { 
                transform: scaleY(1.2) translateX(20px) skewX(4deg);
                filter: brightness(1.2);
            }
            50% { 
                transform: scaleY(0.9) translateX(0) skewX(-4deg);
                filter: brightness(1);
            }
            75% { 
                transform: scaleY(1.1) translateX(-20px) skewX(4deg);
                filter: brightness(1.2);
            }
        }

        /* Enhanced instruction effects */
        .instruction-step {
            text-shadow: 0 0 8px rgba(0, 168, 255, 0.8);
            animation: instructionGlitch 4s infinite, textPulse 2s infinite;
        }

        /* Cyber background */
        .left-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, transparent 48%, #00a8ff 50%, transparent 52%),
                linear-gradient(-45deg, transparent 48%, #0051ff 50%, transparent 52%);
            background-size: 60px 60px;
            opacity: 0.1;
            animation: gridMove 20s linear infinite;
            z-index: -1;
        }

        /* Enhanced button effects */
        .glitch-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            animation: borderGlitch 4s infinite;
        }

        .glitch-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(0, 168, 255, 0.4),
                transparent
            );
            transform: rotate(45deg);
            animation: buttonScan 3s linear infinite;
        }

        @keyframes megaGlitch {
            0% { transform: none; opacity: 1; }
            7% { transform: skew(-0.5deg, -0.9deg); opacity: 0.75; }
            10% { transform: none; opacity: 1; }
            27% { transform: none; opacity: 1; }
            30% { transform: skew(0.8deg, -0.1deg); opacity: 0.75; }
            35% { transform: none; opacity: 1; }
            52% { transform: none; opacity: 1; }
            55% { transform: skew(-1deg, 0.2deg); opacity: 0.75; }
            50% { transform: none; opacity: 1; }
            72% { transform: none; opacity: 1; }
            75% { transform: skew(0.4deg, 1deg); opacity: 0.75; }
            80% { transform: none; opacity: 1; }
            100% { transform: none; opacity: 1; }
        }

        @keyframes glitch-anim-1 {
            0% { clip: rect(30px, 900px, 36px, 0); }
            20% { clip: rect(45px, 900px, 50px, 0); }
            40% { clip: rect(24px, 900px, 30px, 0); }
            60% { clip: rect(10px, 900px, 15px, 0); }
            80% { clip: rect(38px, 900px, 44px, 0); }
            100% { clip: rect(15px, 900px, 20px, 0); }
        }

        @keyframes glitch-anim-2 {
            0% { clip: rect(15px, 900px, 20px, 0); }
            20% { clip: rect(38px, 900px, 44px, 0); }
            40% { clip: rect(10px, 900px, 15px, 0); }
            60% { clip: rect(24px, 900px, 30px, 0); }
            80% { clip: rect(45px, 900px, 50px, 0); }
            100% { clip: rect(30px, 900px, 36px, 0); }
        }

        @keyframes instructionGlitch {
            0%, 100% { transform: translateX(0); }
            88% { transform: translateX(0); }
            90% { transform: translateX(-2px) skewX(20deg); }
            92% { transform: translateX(2px) skewX(-20deg); }
            94% { transform: translateX(-2px); }
            96% { transform: translateX(2px); }
        }

        @keyframes textPulse {
            0%, 100% { text-shadow: 0 0 8px rgba(0, 168, 255, 0.8); }
            50% { text-shadow: 0 0 20px rgba(0, 168, 255, 1); }
        }

        @keyframes borderGlitch {
            0%, 100% { border-color: #00a8ff; }
            25% { border-color: #0051ff; }
            50% { border-color: #ffffff; }
            75% { border-color: #0051ff; }
        }

        @keyframes buttonScan {
            0% { transform: translateX(-200%) rotate(45deg); }
            100% { transform: translateX(200%) rotate(45deg); }
        }

        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 60px 60px; }
        }

        .token-info {
            margin-top: 40px;
            font-family: 'Share Tech Mono', monospace;
            animation: fadeInUp 1s ease-out;
        }

        .token-supply {
            color: #00a8ff;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(0, 168, 255, 0.5);
            animation: supplyGlitch 5s infinite;
        }

        .token-desc {
            color: #fff;
            font-size: 14px;
            line-height: 1.6;
            opacity: 0.9;
            text-shadow: 0 0 5px rgba(0, 168, 255, 0.3);
            animation: descPulse 4s infinite;
        }

        @keyframes supplyGlitch {
            0%, 100% { transform: translateX(0); }
            94% { transform: translateX(0); }
            95% { transform: translateX(-2px) skewX(-10deg); color: #fff; }
            96% { transform: translateX(2px) skewX(10deg); color: #00a8ff; }
            97% { transform: translateX(-2px); color: #fff; }
            98% { transform: translateX(0); color: #00a8ff; }
        }

        @keyframes descPulse {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 0.7; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Add this to your existing styles */
        .page-container::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                /* Animated grid */
                linear-gradient(transparent 0%, rgba(0, 168, 255, 0.05) 2%, transparent 3%) 0 0,
                linear-gradient(90deg, transparent 0%, rgba(0, 168, 255, 0.05) 2%, transparent 3%) 0 0,
                /* Floating particles */
                radial-gradient(circle at 50% 50%, rgba(0, 168, 255, 0.1) 1px, transparent 1px),
                /* Deep space effect */
                linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 20, 0.95));
            background-size: 50px 50px, 50px 50px, 100px 100px, 100% 100%;
            animation: backgroundMove 20s linear infinite;
            z-index: -1;
        }

        /* Add floating orbs */
        .cyber-orb {
            position: fixed;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(0, 168, 255, 0.1), transparent);
            box-shadow: 0 0 60px rgba(0, 168, 255, 0.2);
            pointer-events: none;
            z-index: -1;
        }

        .orb1 { 
            top: 20%;
            left: 10%;
            animation: orbFloat 15s infinite ease-in-out;
        }

        .orb2 {
            bottom: 20%;
            right: 10%;
            animation: orbFloat 20s infinite ease-in-out reverse;
        }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(20px, -20px); }
        }

        @keyframes backgroundMove {
            0% { background-position: 0 0, 0 0, 0 0, 0 0; }
            100% { background-position: 50px 50px, -50px -50px, 100px 100px, 0 0; }
        }

        /* Update existing media query and add new ones */
        @media (max-width: 1200px) {
            .app-container {
                width: 95%;
                margin: 10px auto;
            }
        }

        @media (max-width: 1023px) {
            .app-content {
                flex-direction: column;
            }
            
            .left-panel {
                flex: none;
                width: 100%;
                padding: 20px;
                border-right: none;
                border-bottom: 1px solid rgba(0, 149, 255, 0.2);
            }

            .right-panel {
                padding: 20px;
            }

            .mega-glitch {
                font-size: 3em;
            }
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-wrap: wrap;
            }

            .tool-section {
                width: 100%;
                flex-wrap: wrap;
                justify-content: flex-start;
                gap: 8px;
            }

            .slider-container {
                width: 100%;
                justify-content: space-between;
            }

            .slider {
                width: calc(100% - 80px);
            }

            .text-input {
                width: 100%;
            }

            .header-links {
                flex-direction: column;
                gap: 10px;
            }

            .header-links a {
                width: 100%;
            }

            .mega-glitch {
                font-size: 2.5em;
                letter-spacing: 4px;
            }
        }

        @media (max-width: 480px) {
            .app-container {
                margin: 0;
                border: none;
            }

            .tool-section {
                padding: 8px 4px;
            }

            button.tool {
                min-width: 45px;
                padding: 4px;
                font-size: 11px;
            }

            .mega-glitch {
                font-size: 2em;
                letter-spacing: 2px;
            }

            .instructions {
                font-size: 14px;
            }

            .token-supply {
                font-size: 16px;
            }

            .token-desc {
                font-size: 12px;
            }
        }

        /* Add touch support styles */
        @media (hover: none) {
            .header-links a:hover {
                background: rgba(0, 0, 0, 0.8);
                box-shadow: none;
            }

            button.tool:hover {
                background: #c0c0c0;
            }

            select:hover {
                background: #c0c0c0;
            }
        }

        .header {
            position: relative;
            text-align: center;
            margin-bottom: 20px;
        }

        .header-logo {
            width: 200px;
            height: 200px;
            object-fit: contain;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px rgba(0, 149, 255, 0.5));
        }

        .mega-glitch {
            margin-top: 5px;
        }

        .meme-caption-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 0;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.7);
            border-top: 1px solid rgba(0, 149, 255, 0.2);
        }

        .meme-caption-icon {
            width: 100px;
            height: 100px;
            flex-shrink: 0;
            object-fit: cover;
            border: 1px solid rgba(0, 149, 255, 0.2);
            box-shadow: 0 0 10px rgba(0, 168, 255, 0.2);
        }

        .meme-caption {
            margin: 0;
            color: #00a8ff;
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            text-align: left;
            line-height: 1.4;
            flex: 1;
        }

        .load-winner-btn {
            background: rgba(0, 168, 255, 0.1);
            border: 1px solid #00a8ff;
            color: #00a8ff;
            padding: 8px 16px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .load-winner-btn:hover {
            background: rgba(0, 168, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 168, 255, 0.3);
        }

        /* Update responsive styles */
        @media (max-width: 768px) {
            .meme-caption-container {
                gap: 10px;
            }

            .load-winner-btn {
                padding: 6px 12px;
                font-size: 10px;
            }
        }

        /* Add to your existing styles */
        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            border: 1px solid rgba(0, 149, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.8);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        .template-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            color: #00a8ff;
            padding: 5px;
            font-size: 10px;
            font-family: 'Share Tech Mono', monospace;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .template-tags {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 3px;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tag {
            font-size: 8px;
            color: #00a8ff;
            font-family: 'Share Tech Mono', monospace;
            opacity: 0.8;
        }

        .gallery-item:hover {
            border-color: #00a8ff;
            box-shadow: 0 0 15px rgba(0, 168, 255, 0.3);
            transform: scale(1.05);
        }

        .gallery-item:hover .template-caption {
            transform: translateY(0);
        }

        .gallery-item:hover .template-tags {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .template-caption {
                font-size: 10px;
                padding: 4px;
            }
            
            .template-tags {
                display: none; /* Hide tags on mobile to save space */
            }
        }

        /* Update these gallery styles */
        .meme-gallery {
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 1px solid rgba(0, 149, 255, 0.2);
            margin-top: 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .gallery-title {
            color: #00a8ff;
            font-family: 'Share Tech Mono', monospace;
            font-size: 20px;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(0, 168, 255, 0.5);
        }

        /* Update the gallery grid styles */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 columns */
            gap: 15px;
            padding: 20px;
        }

        /* Update gallery item styles to ensure proper sizing */
        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            border: 1px solid rgba(0, 149, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.8);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        /* Update media queries for responsive grid */
        @media (max-width: 1200px) {
            .gallery-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 15px;
            }
        }

        @media (max-width: 850px) {
            .gallery-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 500px) {
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .gallery-title {
                font-size: 16px;
            }
        }

        .template-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            color: #00a8ff;
            padding: 5px;
            font-size: 10px;
            font-family: 'Share Tech Mono', monospace;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .template-tags {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 3px;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tag {
            font-size: 8px;
            color: #00a8ff;
            font-family: 'Share Tech Mono', monospace;
            opacity: 0.8;
        }

        /* Mobile responsiveness updates */
        @media (max-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 8px;
            }

            .template-caption {
                font-size: 8px;
                padding: 3px;
            }
            
            .gallery-title {
                font-size: 16px;
            }
        }

        /* Add hover effects */
        .gallery-item:hover {
            border-color: #00a8ff;
            box-shadow: 0 0 15px rgba(0, 168, 255, 0.3);
            transform: scale(1.05);
            z-index: 1;
        }

        .gallery-item:hover .template-caption {
            transform: translateY(0);
        }

        .gallery-item:hover .template-tags {
            opacity: 1;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .watermark {
            position: absolute;
            top: 50%; /* Center vertically */
            right: 10px; /* Keep on right side */
            transform: translateY(-50%); /* Perfect vertical centering */
            font-family: 'Impact', sans-serif;
            color: rgba(255, 255, 255, 0.8);
            font-size: 20px;
            text-shadow: 2px 2px 2px rgba(0, 0, 0, 0.8);
            pointer-events: none;
            user-select: none;
            z-index: 100;
        }

        /* Update these existing styles */
        @media (max-width: 1023px) {
            .app-container {
                width: 100%;
                margin: 0;
                border: none;
            }
            
            .app-content {
                flex-direction: column;
                padding: 10px;
                gap: 10px;
            }
            
            .left-panel {
                flex: none;
                width: 100%;
                padding: 15px;
                border-right: none;
                border-bottom: 1px solid rgba(0, 149, 255, 0.2);
            }

            .right-panel {
                padding: 10px;
            }

            /* Adjust header text sizes */
            .mega-glitch {
                font-size: 2.5em;
                letter-spacing: 3px;
            }

            .left-panel p {
                font-size: 0.9em;
            }

            /* Make toolbar more compact */
            .toolbar {
                gap: 2px;
            }

            .tool-section {
                padding: 6px;
                gap: 6px;
                flex-wrap: wrap;
            }

            /* Adjust input sizes */
            .text-input {
                width: 100%;
                max-width: none;
            }

            .slider-container {
                width: 100%;
                justify-content: space-between;
            }

            .slider {
                width: calc(100% - 70px);
            }
        }

        /* Add specific mobile optimizations */
        @media (max-width: 480px) {
            .app-content {
                padding: 5px;
            }

            .tool-section {
                padding: 4px;
            }

            /* Make tools more touch-friendly */
            button.tool {
                min-height: 36px;
                padding: 8px 12px;
                font-size: 14px;
            }

            select, input[type="color"] {
                min-height: 36px;
            }

            /* Adjust text sizes for better readability */
            .instructions {
                font-size: 14px;
                line-height: 1.8;
            }

            .instruction-step {
                margin-bottom: 10px;
            }

            /* Improve gallery layout */
            .gallery-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            .gallery-title {
                font-size: 16px;
                margin-bottom: 10px;
            }

            /* Make header links more touch-friendly */
            .header-links {
                gap: 8px;
            }

            .header-links a {
                padding: 12px 16px;
                font-size: 16px;
            }

            /* Adjust token info for mobile */
            .token-info {
                margin-top: 20px;
            }

            .token-supply {
                font-size: 16px;
            }

            .token-desc {
                font-size: 14px;
                line-height: 1.4;
            }
        }

        /* Add touch-specific optimizations */
        @media (hover: none) {
            /* Increase touch targets */
            .tool, select, input[type="color"], .color-picker {
                min-height: 44px;
                min-width: 44px;
            }

            /* Improve toolbar spacing */
            .tool-section {
                margin-bottom: 8px;
            }

            /* Make sliders easier to use */
            input[type="range"] {
                height: 30px;
                margin: 8px 0;
            }

            /* Adjust text inputs */
            .text-input {
                padding: 8px;
                font-size: 16px; /* Prevents iOS zoom on focus */
            }
        }

        /* Add iPad-specific optimizations */
        @media (min-width: 768px) and (max-width: 1024px) {
            .app-container {
                margin: 10px;
            }

            .tool-section {
                flex-wrap: nowrap;
            }

            .gallery-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Add/update these styles */
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            position: relative;
            background: #000;
        }

        .page-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            background: #000;
        }

        /* Fix canvas container to maintain square aspect ratio */
        .canvas-container {
            position: relative;
            width: 100%;
            padding-bottom: 100%; /* Forces square aspect ratio */
            height: 0;
            overflow: hidden;
            background: #333333;
            border: 1px solid #000;
        }

        #memeImage, #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Mobile-specific fixes */
        @media (max-width: 768px) {
            .page-container {
                padding: 10px;
            }

            .app-container {
                width: 100%;
                margin: 0;
            }

            .canvas-container {
                touch-action: none; /* Prevents unwanted touch behaviors */
                -webkit-overflow-scrolling: touch;
            }

            #drawingCanvas {
                touch-action: none;
                -webkit-user-select: none;
                -webkit-touch-callout: none;
            }

            /* Prevent iOS bouncing/scrolling */
            .app-content {
                overflow: hidden;
                position: relative;
            }
        }
        
        .ios-warning {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            color: #00a8ff;
            padding: 15px;
            z-index: 10000;
            font-family: 'Share Tech Mono', monospace;
            border-bottom: 1px solid #00a8ff;
            animation: glideDown 0.5s ease-out;
        }

        .warning-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        .warning-icon {
            font-size: 20px;
        }

        .ios-warning button {
            background: transparent;
            border: 1px solid #00a8ff;
            color: #00a8ff;
            padding: 5px 15px;
            cursor: pointer;
            font-family: 'Share Tech Mono', monospace;
            transition: all 0.3s ease;
        }

        .ios-warning button:hover {
            background: rgba(0, 168, 255, 0.1);
        }

        @keyframes glideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .crop-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .crop-container {
            position: relative;
            width: 600px;
            height: 600px;
            margin: 20px;
            border: 2px solid #00a8ff;
            overflow: hidden;
        }

        .crop-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .crop-controls button {
            background: transparent;
            border: 1px solid #00a8ff;
            color: #00a8ff;
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'Share Tech Mono', monospace;
            transition: all 0.3s;
        }

        .crop-controls button:hover {
            background: rgba(0, 168, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 168, 255, 0.3);
        }

        .crop-container canvas {
            cursor: move;
        }
    </style>
</head>
<body>
    <div class="cyber-orb orb1"></div>
    <div class="cyber-orb orb2"></div>
    <div class="page-container">
        <!-- Add this iOS warning div right after page-container opens -->
        <div id="iosWarning" class="ios-warning" style="display: none;">
            <div class="warning-content">
                <span class="warning-icon">⚠️</span>
                <p>This site is optimized for Desktop use. Mobile use may produce unintended results.</p>
                <button onclick="dismissWarning()">Got it</button>
            </div>
        </div>
        <div class="app-container">
            <div class="app-content">
                <div class="left-panel">
                    <div class="header">
                        <img src="logo.png" alt="BaseMeme Logo" class="header-logo">
                        <h1 class="mega-glitch">BASEMEME</h1>
                    </div>
                    <p>A place to make fun of crypto. Use our BaseMeme Generator to create memes of crypto legends or upload your own image and edit. Join our TG and share your degenuity to win $BASEMEME tokens on BASE! </p>
                    
                    <div class="header-links">
                        <a href="https://twitter.com/basememewin" class="glitch-button" target="_blank">TWITTER</a>
                        <a href="https://dexscreener.com/base/0x17c997187ff37dd78f11922bf0e6a5becd682a4d" class="glitch-button" target="_blank">DEXSCREENER</a>
                        <a href="https://t.me/basememewin" class="glitch-button" target="_blank">TELEGRAM</a>
                    </div>
                    
                    <div class="instructions">
                        <div class="instruction-step">Use the BASE MEME or Upload New</div>
                        <div class="instruction-step">Enhance with BASEMEME</div>
                        <div class="instruction-step">Save and Submit to <a href="https://t.me/basememe">Telegram</a></div>
                        <div class="instruction-step">Win $BASEMEME on $SOL</div>
                    </div>

                    <div class="token-info">
                        <div class="token-supply">1 BILLION $BASEMEME SUPPLY</div>
                        <div class="token-desc">$BASEMEME is a community-driven meme token launched using Moonshot on the Base  network! Join the memetic revolution and submit your own memes in our TG group to WIN!</div>
                    </div>
                </div>
                <div class="right-panel">
                    <div class="computer-screen">
                        <div class="title-bar">
                            <span>BASEMEME.win - X1 Edition</span>
                        </div>
                        <div class="toolbar">
                            <div class="tool-section">
                                <div class="tool-section-label">Pen:</div>
                                <input type="color" id="drawColor" class="color-picker" value="#000000">
                                <select id="brushStyle" onchange="updateBrush()">
                                    <option value="round">Round</option>
                                    <option value="square">Square</option>
                                    <option value="spray">Spray</option>
                                </select>
                                <div class="slider-container">
                                    <span class="slider-label">Thickness:</span>
                                    <input type="range" id="penThickness" class="slider" min="1" max="20" value="5">
                                </div>
                            </div>
                            
                            <div class="tool-section">
                                <div class="tool-section-label">Text:</div>
                                <textarea id="topInput" class="text-input" placeholder="Top Caption" rows="2"></textarea>
                                <textarea id="bottomInput" class="text-input" placeholder="Bottom Caption" rows="2"></textarea>
                                <select id="fontSelect">
                                    <option value="Impact">Impact</option>
                                    <option value="Arial">Arial</option>
                                    <option value="Comic Sans MS">Comic Sans MS</option>
                                </select>
                                <input type="color" id="textColor" value="#FFFFFF">
                                <div class="slider-container">
                                    <span class="slider-label">Size:</span>
                                    <input type="range" id="fontSize" class="slider" min="20" max="100" value="40">
                                </div>
                            </div>

                            <div class="tool-section">
                                <div class="tool-section-label">Tools:</div>
                                <button class="tool" onclick="downloadMeme()">Save</button>
                                <button class="tool">
                                    <label for="imageUpload">Upload</label>
                                    <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)" style="display: none;">
                                </button>
                                <button class="tool" onclick="undo()">Undo</button>
                                <button class="tool" onclick="redo()">Redo</button>
                                <button class="tool" onclick="clearCanvas()">Clear</button>
                            </div>
                        </div>
                        <div class="canvas-container">
                            <img id="memeImage" src="" alt="Default meme template">
                            <canvas id="drawingCanvas"></canvas>
                            <div id="topText" class="meme-text"></div>
                            <div id="bottomText" class="meme-text"></div>
                            <div class="watermark">basememe.win</div>
                        </div>
                        <div class="meme-caption-container">
                            <img src="meme0.jpg" alt="Basememe of the Week" class="meme-caption-icon">
                            <button class="load-winner-btn" onclick="loadWinnerMeme()">LOAD WINNER</button>
                            <p class="meme-caption">
                                BASEMEME of the Week: Brian  Armstrong, CEO of COINBASE 
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="meme-gallery">
                <div class="gallery-title">SELECT YOUR BASE TEMPLATE</div>
                <div class="gallery-grid">
                    <!-- Gallery items -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        window.addEventListener('load', initializeMemeEditor);

        function initializeMemeEditor() {
            const memeImage = document.getElementById('memeImage');
            const defaultImage = 'meme0.jpg';
            
            memeImage.src = defaultImage;
            memeImage.onload = function() {
                console.log('Default image loaded successfully');
                handleImageLoad(this);
                resizeCanvas();
                updateTextPositions();
                
                // Enable all controls after image loads
                document.querySelectorAll('button, input, select').forEach(el => {
                    el.disabled = false;
                });
            };
        }

        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const topTextInput = document.getElementById('topInput');
        const bottomTextInput = document.getElementById('bottomInput');
        const topTextDiv = document.getElementById('topText');
        const bottomTextDiv = document.getElementById('bottomText');
        const memeImage = document.getElementById('memeImage');
        const fontSizeInput = document.getElementById('fontSize');
        const fontSelect = document.getElementById('fontSelect');
        const textColorInput = document.getElementById('textColor');
        const penThicknessInput = document.getElementById('penThickness');
        
        let isDrawing = false;
        let currentTool = 'pen';
        let undoStack = [];
        let redoStack = [];
        let lastX, lastY;

        const MAX_CANVAS_SIZE = 800; // Maximum width/height we'll allow

        function resizeCanvas() {
            const container = canvas.parentElement;
            const rect = container.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // Maintain aspect ratio
            if (memeImage.complete) {
                const aspectRatio = memeImage.naturalHeight / memeImage.naturalWidth;
                container.style.height = `${rect.width * aspectRatio}px`;
            }
            
            updateBrush();
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
        canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
        canvas.addEventListener('touchend', stopDrawing);
        canvas.addEventListener('touchcancel', stopDrawing);

        function startDrawing(e) {
            isDrawing = true;
            saveState();
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            lastX = (e.clientX - rect.left) * scaleX;
            lastY = (e.clientY - rect.top) * scaleY;
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            updateBrush();
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            performDraw(x, y);
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.closePath();
        }

        function updateBrush() {
            const color = document.getElementById('drawColor').value;
            const size = penThicknessInput.value;
            
            ctx.strokeStyle = color;
            ctx.lineWidth = size;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }

        function setColor(color) {
            document.getElementById('drawColor').value = color;
            updateBrush();
        }

        // Add this function to handle image uploads with cropping
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Create temporary elements for cropping
            const modal = document.createElement('div');
            modal.className = 'crop-modal';
            
            const cropContainer = document.createElement('div');
            cropContainer.className = 'crop-container';
            
            const tempImg = new Image();
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = 600;
            tempCanvas.height = 600;
            
            modal.innerHTML = `
                <div class="crop-controls">
                    <button id="zoomIn">Zoom In</button>
                    <button id="zoomOut">Zoom Out</button>
                    <button id="confirmCrop">Confirm</button>
                    <button id="cancelCrop">Cancel</button>
                </div>
            `;
            
            modal.appendChild(cropContainer);
            cropContainer.appendChild(tempCanvas);
            document.body.appendChild(modal);

            // Image transformation variables
            let scale = 1;
            let offsetX = 0;
            let offsetY = 0;
            let isDragging = false;
            let startX, startY;

            // Load the image
            const reader = new FileReader();
            reader.onload = (e) => {
                tempImg.src = e.target.result;
                tempImg.onload = () => {
                    // Initial scale to fit the image
                    scale = Math.max(600 / tempImg.width, 600 / tempImg.height);
                    drawCroppedImage();
                };
            };
            reader.readAsDataURL(file);

            function drawCroppedImage() {
                const ctx = tempCanvas.getContext('2d');
                ctx.clearRect(0, 0, 600, 600);
                
                // Fill background
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, 600, 600);
                
                // Draw image with current transformations
                ctx.save();
                ctx.translate(300 + offsetX, 300 + offsetY);
                ctx.scale(scale, scale);
                ctx.translate(-tempImg.width/2, -tempImg.height/2);
                ctx.drawImage(tempImg, 0, 0);
                ctx.restore();
            }

            // Event listeners for controls
            document.getElementById('zoomIn').addEventListener('click', () => {
                scale *= 1.1;
                drawCroppedImage();
            });

            document.getElementById('zoomOut').addEventListener('click', () => {
                scale *= 0.9;
                drawCroppedImage();
            });

            // Dragging functionality
            tempCanvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                startX = e.clientX - offsetX;
                startY = e.clientY - offsetY;
            });

            tempCanvas.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                offsetX = e.clientX - startX;
                offsetY = e.clientY - startY;
                drawCroppedImage();
            });

            tempCanvas.addEventListener('mouseup', () => {
                isDragging = false;
            });

            // Confirm crop
            document.getElementById('confirmCrop').addEventListener('click', () => {
                // Get the final cropped image
                const finalImage = tempCanvas.toDataURL('image/png');
                memeImage.src = finalImage;
                memeImage.onload = () => handleImageLoad(memeImage);
                document.body.removeChild(modal);
            });

            // Cancel crop
            document.getElementById('cancelCrop').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }

        function handleImageLoad(img) {
            try {
                const container = document.querySelector('.canvas-container');
                
                // Force square dimensions based on container width
                const size = container.clientWidth;
                canvas.width = size;
                canvas.height = size;
                
                // Update container to be square
                container.style.paddingBottom = '100%';
                
                // Clear and draw image maintaining square aspect
                ctx.clearRect(0, 0, size, size);
                if (img.complete && img.naturalHeight !== 0) {
                    // Calculate dimensions to maintain aspect ratio within square
                    const scale = Math.min(size / img.naturalWidth, size / img.naturalHeight);
                    const x = (size - img.naturalWidth * scale) / 2;
                    const y = (size - img.naturalHeight * scale) / 2;
                    
                    ctx.drawImage(img, x, y, img.naturalWidth * scale, img.naturalHeight * scale);
                }
                
                updateTextPositions();
            } catch (error) {
                console.error('Error handling image load:', error);
                // Set fallback dimensions
                canvas.width = 800;
                canvas.height = 800;
            }
        }

        function downloadMeme() {
            html2canvas(document.querySelector('.canvas-container')).then(canvas => {
                const ctx = canvas.getContext('2d');
                
                // Add watermark to the downloaded image
                ctx.font = '20px Impact';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.8)';
                
                const watermark = 'basememe.win';
                const padding = 20;
                const metrics = ctx.measureText(watermark);
                const x = canvas.width - metrics.width - padding;
                const y = canvas.height - padding;
                
                ctx.lineWidth = 2;
                ctx.strokeText(watermark, x, y);
                ctx.fillText(watermark, x, y);
                
                // For iOS, create a temporary link in the page
                if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
                    const imgData = canvas.toDataURL('image/png');
                    
                    // Create a temporary container
                    const container = document.createElement('div');
                    container.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(0,0,0,0.8);
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        z-index: 10000;
                        padding: 20px;
                    `;
                    
                    // Create image wrapper that matches the original canvas container
                    const imgWrapper = document.createElement('div');
                    const originalContainer = document.querySelector('.canvas-container');
                    const rect = originalContainer.getBoundingClientRect();
                    
                    imgWrapper.style.cssText = `
                        width: ${rect.width}px;
                        height: ${rect.height}px;
                        position: relative;
                        margin-bottom: 20px;
                    `;
                    
                    // Add the image
                    const img = document.createElement('img');
                    img.src = imgData;
                    img.style.cssText = `
                        width: 100%;
                        height: 100%;
                        object-fit: contain;
                    `;
                    
                    imgWrapper.appendChild(img);
                    container.appendChild(imgWrapper);
                    
                    // Add instructions
                    const text = document.createElement('p');
                    text.textContent = 'Press and hold image to save';
                    text.style.cssText = 'color: white; font-family: Arial; margin-bottom: 20px;';
                    
                    // Add close button
                    const closeBtn = document.createElement('button');
                    closeBtn.textContent = 'Close';
                    closeBtn.style.cssText = `
                        padding: 10px 20px;
                        background: #00a8ff;
                        border: none;
                        color: white;
                        border-radius: 5px;
                        cursor: pointer;
                    `;
                    
                    closeBtn.onclick = () => document.body.removeChild(container);
                    
                    container.appendChild(text);
                    container.appendChild(closeBtn);
                    document.body.appendChild(container);
                    
                    // Also close when clicking outside the image
                    container.onclick = (e) => {
                        if (e.target === container) {
                            document.body.removeChild(container);
                        }
                    };
                } else {
                    // For other devices, download directly
                    canvas.toBlob(function(blob) {
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.download = 'basememe.png';
                        link.href = url;
                        link.click();
                        URL.revokeObjectURL(url);
                    }, 'image/png');
                }
            });
        }

        topTextInput.addEventListener('input', (e) => {
            topTextDiv.textContent = e.target.value;
        });

        bottomTextInput.addEventListener('input', (e) => {
            bottomTextDiv.textContent = e.target.value;
        });

        fontSizeInput.addEventListener('input', updateText);
        fontSelect.addEventListener('change', updateText);
        textColorInput.addEventListener('input', updateText);
        topTextInput.addEventListener('input', updateText);
        bottomTextInput.addEventListener('input', updateText);

        memeImage.onerror = function() {
            console.error('Error loading image:', this.src);
            this.src = 'meme0.jpg';
            // Set a minimum size for the container
            const container = document.querySelector('.canvas-container');
            container.style.minHeight = '450px';
        };

        function saveState() {
            undoStack.push(canvas.toDataURL());
            redoStack = []; // Clear redo stack when new action is performed
        }

        function undo() {
            if (undoStack.length > 0) {
                redoStack.push(canvas.toDataURL());
                const imgData = undoStack.pop();
                loadCanvasState(imgData);
            }
        }

        function redo() {
            if (redoStack.length > 0) {
                undoStack.push(canvas.toDataURL());
                const imgData = redoStack.pop();
                loadCanvasState(imgData);
            }
        }

        function loadCanvasState(imgData) {
            const img = new Image();
            img.src = imgData;
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
            };
        }

        function clearCanvas() {
            saveState();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function drawSpray(x, y) {
            const density = 50;
            const radius = ctx.lineWidth * 2;
            
            for (let i = 0; i < density; i++) {
                const offsetX = getRandomInt(-radius, radius);
                const offsetY = getRandomInt(-radius, radius);
                
                if (offsetX * offsetX + offsetY * offsetY <= radius * radius) {
                    ctx.fillStyle = ctx.strokeStyle;
                    ctx.fillRect(x + offsetX, y + offsetY, 1, 1);
                }
            }
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            lastX = (touch.clientX - rect.left) * scaleX;
            lastY = (touch.clientY - rect.top) * scaleY;
            
            isDrawing = true;
            saveState();
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            updateBrush();
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!isDrawing) return;
            
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (touch.clientX - rect.left) * scaleX;
            const y = (touch.clientY - rect.top) * scaleY;
            
            performDraw(x, y);
        }

        // Consolidated event listeners
        fontSizeInput.addEventListener('input', updateText);
        fontSelect.addEventListener('change', updateText);
        textColorInput.addEventListener('input', updateText);
        topTextInput.addEventListener('input', updateText);
        bottomTextInput.addEventListener('input', updateText);

        // Add function to handle text positioning
        function updateTextPositions() {
            const topTextDiv = document.getElementById('topText');
            const bottomTextDiv = document.getElementById('bottomText');
            
            // Position text based on canvas dimensions
            topTextDiv.style.width = `${canvas.width}px`;
            bottomTextDiv.style.width = `${canvas.width}px`;
            
            // Update font size relative to canvas size
            const baseFontSize = Math.max(20, Math.min(40, canvas.width / 15));
            fontSizeInput.value = baseFontSize;
            updateText(); // Your existing text update function
        }

        // Update event listeners to handle textarea
        document.querySelectorAll('.text-input').forEach(textarea => {
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
                updateText();
            });
        });

        function updateText() {
            const fontSize = fontSizeInput.value;
            const font = fontSelect.value;
            const color = textColorInput.value;
            
            // Update top text
            topTextDiv.style.fontSize = `${fontSize}px`;
            topTextDiv.style.fontFamily = font;
            topTextDiv.style.color = color;
            topTextDiv.textContent = topTextInput.value.toUpperCase();
            
            // Update bottom text
            bottomTextDiv.style.fontSize = `${fontSize}px`;
            bottomTextDiv.style.fontFamily = font;
            bottomTextDiv.style.color = color;
            bottomTextDiv.textContent = bottomTextInput.value.toUpperCase();
        }

        // Initialize the canvas and text when the page loads
        window.addEventListener('load', () => {
            resizeCanvas();
            updateText();
            updateTextPositions();
        });

        // Handle window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                resizeCanvas();
                updateTextPositions();
            }, 250);
        });

        // Create a shared drawing function
        function performDraw(x, y) {
            const brushStyle = document.getElementById('brushStyle').value;
            
            switch(brushStyle) {
                case 'spray':
                    drawSpray(x, y);
                    break;
                case 'square':
                    ctx.lineCap = 'square';
                    ctx.lineJoin = 'miter';
                    ctx.lineTo(x, y);
                    ctx.stroke();
                    break;
                default: // round
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    ctx.lineTo(x, y);
                    ctx.stroke();
            }
            
            lastX = x;
            lastY = y;
        }

        // Update the MEME_TEMPLATES array to start from meme1
        const MEME_TEMPLATES = [
            { id: 1, filename: 'meme1.jpg', caption: 'Meme 1' },
            { id: 2, filename: 'meme2.jpg', caption: 'Meme 2' },
            { id: 3, filename: 'meme3.jpg', caption: 'Meme 3' },
            { id: 4, filename: 'meme4.jpg', caption: 'Meme 4' },
            { id: 5, filename: 'meme5.jpg', caption: 'Meme 5' },
            { id: 6, filename: 'meme6.jpg', caption: 'Meme 6' },
            { id: 7, filename: 'meme7.jpg', caption: 'Meme 7' },
            { id: 8, filename: 'meme8.jpg', caption: 'Meme 8' },
            { id: 9, filename: 'meme9.jpg', caption: 'Meme 9' },
            { id: 10, filename: 'meme10.jpg', caption: 'Meme 10' },
            { id: 11, filename: 'meme11.jpg', caption: 'Meme 11' },
            { id: 12, filename: 'meme12.jpg', caption: 'Meme 12' },
            { id: 13, filename: 'meme13.jpg', caption: 'Meme 13' },
            { id: 14, filename: 'meme14.jpg', caption: 'Meme 14' },
            { id: 15, filename: 'meme15.jpg', caption: 'Meme 15' },
            { id: 16, filename: 'meme16.jpg', caption: 'Meme 16' },
            { id: 17, filename: 'meme17.jpg', caption: 'Meme 17' },
            { id: 18, filename: 'meme18.jpg', caption: 'Meme 18' },
            { id: 19, filename: 'meme19.jpg', caption: 'Meme 19' },
            { id: 20, filename: 'meme20.jpg', caption: 'Meme 20' }
        ];

        // Update gallery initialization to show all images
        function initializeGallery() {
            const galleryGrid = document.querySelector('.gallery-grid');
            galleryGrid.innerHTML = '';

            MEME_TEMPLATES.forEach(template => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';

                galleryItem.innerHTML = `
                    <img src="${template.filename}" 
                         alt="Meme Template ${template.id}"
                         onerror="this.onerror=null; this.src='meme0.jpg'">
                    <div class="template-caption">Template ${template.id}</div>
                    <div class="template-tags">
                        <span class="tag">#BASE</span>
                        <span class="tag">#MEME</span>
                    </div>
                `;

                galleryItem.addEventListener('click', () => {
                    memeImage.src = template.filename;
                    memeImage.onload = () => handleImageLoad(memeImage);
                });

                galleryGrid.appendChild(galleryItem);
            });
        }

        // Call this function on window load or document ready
        window.addEventListener('load', initializeGallery);

        // Temporary solution until you have real images
        const defaultImage = 'https://via.placeholder.com/800x450/333333/00a8ff?text=BASE+MEME';

        function loadWinnerMeme() {
            // Load the winning meme into the editor
            memeImage.src = 'meme0.jpg';
            memeImage.onload = () => handleImageLoad(memeImage);
            
            // Optional: Add a visual feedback for the button click
            const btn = document.querySelector('.load-winner-btn');
            btn.style.backgroundColor = 'rgba(0, 168, 255, 0.3)';
            setTimeout(() => {
                btn.style.backgroundColor = 'rgba(0, 168, 255, 0.1)';
            }, 200);
        }

        // Add iOS detection and warning
        function showIOSWarning() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                         (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
            const warning = document.getElementById('iosWarning');
            if (isIOS && warning) {
                warning.style.display = 'block';
            }
        }
        

        function dismissWarning() {
            const warning = document.getElementById('iosWarning');
            if (warning) {
                warning.style.display = 'none';
            }
        }

        // Add to window load event
        window.addEventListener('load', () => {
            initializeMemeEditor();
            initializeGallery();
            showIOSWarning();
        });
    </script>
</body>
</html>
